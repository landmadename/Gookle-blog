(this.webpackJsonpblog=this.webpackJsonpblog||[]).push([[0],{40:function(e,t,n){e.exports=n(59)},51:function(e,t,n){},52:function(e,t,n){},56:function(e,t,n){},57:function(e,t,n){},58:function(e,t,n){},59:function(e,t,n){"use strict";n.r(t);var o=n(0),i=n.n(o),a=n(18),r=n.n(a),c=n(7),s=n(19),l={album:{},boxes:{},gookles:{},wheight:window.innerHeight/1,wwidth:window.innerWidth/1,debug:0,mx:0,level:0,pageUrl:""},u=n(6),d=n(8),f=n(10),h=n(9),p=n(11);Object(c.b)((function(e){return{mx:e.mx}}))((function(e){return i.a.createElement("h2",{style:{position:"absolute"}},e.mx)}));var m=n(12),b=n(34),x=n(24),g=n(23),_=n(60),y={site:"http://blog.lamony.cn",default_image:"http://blog.lamony.cn/media/original_images/lalala.jpg",root_box_id:4};n(51),n(52);function w(){var e=Object(b.a)(["\n    position: absolute;\n    border-radius: 10px;\n    padding: 10px;\n    width: ","px;\n    height: ","px;\n    z-index: 100;\n    transform: translate3d(\n        ","px,\n        ","px,\n        0\n    );\n    background-color: white;\n    box-shadow: 0 12.5px 30px 80px rgba(50, 50, 73, 0.6),\n    0 10px 10px -10px rgba(50, 50, 73, 0.3);\n"]);return w=function(){return e},e}var v=x.a.div(w(),(function(e){return e.wwidth-.05*e.wheight-20}),(function(e){return e.wheight-.05*e.wheight-20}),(function(e){return.025*e.wheight}),(function(e){return.025*e.wheight}));var O=Object(c.b)((function(e){return{wheight:e.wheight,wwidth:e.wwidth,pageUrl:e.pageUrl}}),(function(e){return{setPageUrl:function(t){e({type:"setPageUrl",payload:t})}}}))((function(e){var t=e.wheight,n=e.wwidth,a=e.pageUrl,r=Object(g.b)((function(){return{y:-1.3*t}})),c=Object(m.a)(r,2),s=c[0],l=c[1],u=Object(o.useState)(""),d=Object(m.a)(u,2),f=d[0],h=d[1],p=function(){""!==e.pageUrl?e.setPageUrl(""):window.history.back()};return Object(o.useEffect)((function(){return window.addEventListener("popstate",p,!1),""===a?(l((function(){return{y:-1.3*t}})),setTimeout((function(){h("")}),500)):(!function(e,t){var n="";console.log(e),fetch(e).then((function(e){return e.text()})).then((function(e){n=(n=(n=e).replace(/src="\//g,'src="http://blog.lamony.cn/')).replace(/<link .*?>/g,""),t(n)}),(function(e){console.log(e)}))}(a,h),l((function(){return{y:0}}))),function(){window.removeEventListener("popstate",p,!1)}}),[a]),i.a.createElement(_.a.div,{style:{transform:s.y.interpolate((function(e){return"translate3d(0,".concat(e,"px,0)")})),position:"absolute",zIndex:100,width:n,height:t,borderRadius:"10px"},onClick:function(){e.setPageUrl("")}},i.a.createElement(v,{wwidth:n,wheight:t,style:{}},i.a.createElement("div",{id:"content",dangerouslySetInnerHTML:{__html:f},style:{overflow:"scroll",width:"100%",height:"100%"}})))})),j=n(22);function k(e,t,n,o,i,a){var r=this;this.box=e,this.position=t,this.id=n,this.url=o,this.face=i,this.spring=new g.a({from:a}),this.set=function(e){r.spring.update(e).start()}}var E=n(5);var I=Object(c.b)((function(e){return{wheight:e.wheight,wwidth:e.wwidth}}))((function(e){var t=e.wheight,n=e.wwidth,o=e.face,a=e.i,r=e.x,c=e.y,s=e.rot,l=e.scale,u=e.bind;return i.a.createElement(_.a.div,Object.assign({},u(a),{style:{transform:Object(E.f)([r,c,s,l],(function(e,t,n,o){return"translate3d(".concat(e,"px,").concat(t,"px,0)  rotateZ(").concat(n,"deg) scale(").concat(o,") translate3d(-50%,-50%,0)")})),position:"absolute"}}),i.a.createElement("img",{src:o,id:a,style:{width:"auto",height:"auto",maxWidth:n<t?.9*n:.8*t,maxHeight:.8*t,filter:"drop-shadow(10px 11.5px 8px rgba(50, 50, 73, 0.6))"},draggable:"false"}))}));n(56);function N(e){return console.log(e),{type:"addToCollection",payload:e}}var D=Object(c.b)((function(e){return{wheight:e.wheight,wwidth:e.wwidth,debug:e.debug,boxes:e.boxes,album:e.album,gookles:e.gookles,level:e.level,mx:e.mx}}),(function(e){return{pushGookles:function(t){e({type:"pushGookles",payload:t})},moveDeck:function(t){e(function(e){return{type:"moveDeck",payload:e}}(t))},addToCollection:function(t){e(N(t))},shiftLevel:function(t){e(function(e){return{type:"shiftLevel",payload:e}}(t))},setPageUrl:function(t){e({type:"setPageUrl",payload:t})}}}))((function(e){var t=e.collectionName,n=e.wheight,a=e.wwidth,r=e.xIndex,c=e.yIndex,s=e.level,l=e.debug,u=Object(o.useState)(c>=0),d=Object(m.a)(u,2),f=d[0],h=d[1],p=Object(o.useState)((function(){return new Set})),b=Object(m.a)(p,2),x=b[0],w=b[1],v=Object(o.useState)((function(){return new Set})),O=Object(m.a)(v,1)[0],E=Object(g.b)((function(){return{xy:[r,c+s]}})),D=Object(m.a)(E,2),L=D[0],U=D[1],A=Object(o.useRef)(0),G=Object(o.useRef)(0),P=Object(o.useRef)(!0),S={x:1e7,rot:0,scale:1.1,y:0},T=function(e){return{x:f?a*e:0,y:0,scale:1,rot:20*Math.random()-10,delay:100*e}},M=function(e,t){return"translate3d(\n        ".concat(.5*a+a*e,"px, \n        ").concat(.5*n+n*(t+l),"px,\n        0\n        )")};function B(){Object.keys(x).length-1- -r<2&&f&&(console.log(x),console.log("Load Gookles"),function(e,t,n,o,i,a){function r(n){var i=[],a={};fetch(n).then((function(e){return e.json()})).then((function(n){for(var r in n.items)i.push({id:n.items[r].id,url:n.items[r].meta.html_url,face:o[n.items[r].image.id]}),a[e]=i,t(a)}),(function(e){console.log(e)}))}var c=n[e].id;switch(i=-1===i?0:i){case 0:r(-1===c?y.site+"/api/v2/pages/?type=home.GooklePage&limit=200&fields=image,show_in_latest,show_in_the_top_of_deck,show_in_the_top_of_latest&offset="+i+"&order="+(n[e].order_by_latest?"-first_published_at":"first_published_at")+"&show_in_latest=true":y.site+"/api/v2/pages/?type=home.GooklePage&limit=200&fields=image,show_in_latest,show_in_the_top_of_deck,show_in_the_top_of_latest&child_of="+c+"&offset="+i+"&order="+(n[e].order_by_latest?"-first_published_at":"first_published_at")+"&show_in_the_top_of_deck=true");default:r(-1===c?y.site+"/api/v2/pages/?type=home.GooklePage&limit=200&fields=image,show_in_latest,show_in_the_top_of_deck,show_in_the_top_of_latest&offset="+i+"&order="+(n[e].order_by_latest?"-first_published_at":"first_published_at")+"&show_in_latest=true":y.site+"/api/v2/pages/?type=home.GooklePage&limit=200&fields=image,show_in_latest,show_in_the_top_of_deck,show_in_the_top_of_latest&child_of="+c+"&offset="+i+"&order="+(n[e].order_by_latest?"-first_published_at":"first_published_at")+"&show_in_the_top_of_deck=false")}}(t,e.pushGookles,e.boxes,e.album,Object.keys(x).length-1))}var C=Object(j.a)((function(t){var n=Object(m.a)(t.args,1)[0],o=t.down,i=t.tap,s=Object(m.a)(t.movement,2),l=s[0],u=s[1],d=Object(m.a)(t.direction,2),h=d[0],p=d[1],b=t.velocity;i&&(console.log("hi"),e.setPageUrl(x[n].url)),console.log("start");var g=h<0?-1:1,_=b>.2&&-1===g,y=b>.2&&1===(p<0?-1:1);if(G.current=n,!o&&_)switch(c){case-1:e.moveDeck({collectionName:e.collectionName,index:-1,dir:"left"});break;case 0:e.moveDeck({collectionName:e.collectionName,index:0,dir:"left"}),O.add(n);break;case 1:e.moveDeck({collectionName:e.collectionName,index:1,dir:"left"}),O.add(n)}else if(!o&&y)switch(c){case-1:P.current=!0,e.moveDeck({collectionName:e.collectionName,index:-1,dir:"down"}),setTimeout((function(){e.shiftLevel(0)}),300);break;case 0:N({collectionName:e.collectionName,xIndex:r,fn:"plus",dir:"down"})}var w=O.has(n),v=o?l:f?x[G.current].position*a:0,j=w?-0:o?u:0,k=w?10*g*b:0,E=o?1.1:1;w&&O.clear(),x[n].set({x:v,y:j,rot:k,scale:E,delay:void 0,config:{friction:50,tension:o?800:w?200:500}})}),{initial:function(){if(-1===c)return[0,0];var e={};return Object.keys(x).map((function(t){e[x[t].position]=x[t].id})),[x[e[-r]].position*a,0]}});return Object(o.useEffect)((function(){Object.keys(x).map((function(e){x[e].set(T(x[e].position))})),B()}),[f]),Object(o.useEffect)((function(){console.log("gookles updated!");var n=Object.assign({},x),o=!1;e.gookles[t].map((function(e){null==n[e.id]&&(n[e.id]=new k(t,Object.keys(n).length-1,e.id,e.url,e.face,S),n[e.id].set(T(n[e.id].position)),o=!0)})),o&&w((function(){return n}))}),[e.gookles]),Object(o.useEffect)((function(){if(c+s===0&&0!==e.mx)if(P.current=!1,-1===c){var n=[];Object.keys(e.boxes).map((function(t){-1===e.boxes[t].yIndex&&n.push(t)})),t===n[0]&&(e.mx>A.current?e.moveDeck({collectionName:e.collectionName,index:c,dir:"left"}):e.moveDeck({collectionName:e.collectionName,index:c,dir:"right"}))}else e.mx>A.current?e.moveDeck({collectionName:e.collectionName,index:c,dir:"left"}):e.moveDeck({collectionName:e.collectionName,index:c,dir:"right"});A.current=e.mx}),[e.mx]),Object(o.useEffect)((function(){h(c>=0),U((function(){return{xy:[r,c+s]}})),B(),P.current&&(setTimeout((function(){U((function(){return{xy:[r+.001,c+s+.001]}}))}),300),setTimeout((function(){U((function(){return{xy:[r,c+s]}}))}),300))}),[s,r,c]),Object.keys(x).map((function(e){return i.a.createElement(_.a.div,{key:x[e].id,style:{transform:L.xy.interpolate(M)}},i.a.createElement(I,{face:x[e].face,url:x[e].url,i:x[e].id,x:x[e].spring.animated.x,y:x[e].spring.animated.y,rot:x[e].spring.animated.rot,scale:x[e].spring.animated.scale,bind:C}))}))})),L=function(e){function t(){return Object(u.a)(this,t),Object(f.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){var e=this;return console.log("Decks load"),Object.keys(this.props.boxes).map((function(t){return i.a.createElement(D,{key:t,collectionName:t,xIndex:e.props.boxes[t].xIndex,yIndex:e.props.boxes[t].yIndex})}))}}]),t}(o.Component),U=Object(c.b)((function(e){return{boxes:e.boxes}}),{})(L);n(57);var A=Object(c.b)((function(e){return{level:e.level}}),(function(e){return{sendMx:function(t){e({type:"Mx",payload:{mx:t}})},shiftLevel:function(t){e(function(e){return{type:"shiftLevel",payload:e}}(t))}}}))((function(e){var t=Object(j.a)((function(t){var n=t.down,o=t.movement[0],i=t.tap,r=n?.6:1;console.log(i,n),i?(Date.now()-s.current>200&&(h({xAs:[o,1]}),e.shiftLevel((e.level+1)%2)),s.current=Date.now()):(h({xAs:[n?o:.5*a,r]}),o=n?o:.5*a,0!==parseInt(o%10)&&o!==.5*a||e.sendMx(parseInt((o-.5*a)/10)))}),{axis:"x",initial:function(){return[parseInt(f[0].xAs.getValue()[0]),580]},filterTaps:!1}),n=window.innerHeight,a=window.innerWidth,r={tension:1200,friction:40},c={mass:1,tension:800,friction:50},s=Object(o.useRef)(Date.now()),l=function(e,t){return"translate3d(".concat(e,"px,").concat(.9*n,"px,0) translate3d(-50%,-50%,0) scale(").concat(t,")")},u=Object(g.c)(6,(function(){return{xAs:[.5*a,1],config:function(e){return 0===e?r:c}}})),d=Object(m.a)(u,2),f=d[0],h=d[1];return i.a.createElement("div",{onMouseDown:function(){h({xAs:[parseInt(f[0].xAs.getValue()[0]),.6]})},onMouseLeave:function(){h({xAs:[parseInt(f[0].xAs.getValue()[0]),1]})}},i.a.createElement("svg",{style:{position:"absolute",width:0,height:0}},i.a.createElement("filter",{id:"goo"},i.a.createElement("feGaussianBlur",{in:"SourceGraphic",result:"blur",stdDeviation:"130"}),i.a.createElement("feColorMatrix",{in:"blur",values:"1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 25 -5"}))),i.a.createElement("div",{className:"hooks-main"},f.map((function(e,n){return n?i.a.createElement(_.a.div,{key:n,style:{transform:e.xAs.interpolate(l)}}):i.a.createElement(_.a.div,Object.assign({},t(n),{key:n,style:{transform:e.xAs.interpolate(l)}}))}))))})),G=function(e){function t(){return Object(u.a)(this,t),Object(f.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"render",value:function(){return console.log("One load"),i.a.createElement("div",null,i.a.createElement(U,null),i.a.createElement(A,null))}}]),t}(o.Component),P=function(e){function t(){return Object(u.a)(this,t),Object(f.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){!function(e){var t={};fetch(y.site+"/api/v2/images/?limit=200").then((function(e){return e.json()})).then((function(n){for(var o in n.items)t[n.items[o].id]=y.site+n.items[o].meta.download_url;e(t)}),(function(e){console.log(e)}))}(this.props.setAlbum),function(e,t){var n={},o={},i=0;n.Latest={id:-1,order_by_latest:!0,xIndex:0,yIndex:0},o.Latest=[{id:-1,url:null,face:y.default_image}],t(o),fetch(y.site+"/api/v2/pages/?type=home.BoxPage&child_of="+y.root_box_id+"&fields=image,order_by_latest&limit=200").then((function(e){return e.json()})).then((function(a){for(var r in a.items)n[a.items[r].title]={id:a.items[r].id,order_by_latest:a.items[r].order_by_latest,xIndex:i++,yIndex:-1},(o={})[a.items[r].title]=[{id:-1,url:y.site+a.items[r].image.meta.html_url,face:y.site+a.items[r].image.meta.download_url}],t(o);e(n)}),(function(e){console.log(e)}))}(this.props.setBoxes,this.props.pushGookles)}},{key:"render",value:function(){return 0==Object.keys(this.props.boxes)||0==Object.keys(this.props.album)?i.a.createElement("div",null,"loading"):i.a.createElement("div",null,i.a.createElement(O,null),i.a.createElement(G,null))}}]),t}(o.Component),S=Object(c.b)((function(e){return{boxes:e.boxes,album:e.album}}),(function(e){return{setAlbum:function(t){e({type:"setAlbum",payload:{album:t}})},setBoxes:function(t){e({type:"setBoxes",payload:{boxes:t}})},pushGookles:function(t){e({type:"pushGookles",payload:t})}}}))(P),T=(n(58),Object(s.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0,n=t.type,o=t.payload;switch(n){case"pushGookles":var i=Object.keys(o)[0],a=Object.assign({},e.gookles),r=o[i],c=[];null==a[i]?(c=[],a[i]=[]):c=a[i].map((function(e){return e.id}));for(var s=0;s<r.length;s++)c.indexOf(r[s].id)&&a[i].push(r[s]);return a={gookles:a},Object.assign({},e,a);case"setAlbum":case"setBoxes":case"Mx":return Object.assign({},e,o);case"moveDeck":var u=Object.assign({},e.boxes);if("left"===o.dir)Object.keys(u).map((function(e){return u[e].yIndex===o.index&&(u[e].xIndex=u[e].xIndex-1),0}));else if("right"===o.dir)Object.keys(u).map((function(e){return u[e].yIndex===o.index&&(u[e].xIndex=u[e].xIndex+1),0}));else if("down"===o.dir){var d=0;Object.keys(u).map((function(e){return 0===u[e].yIndex&&(d=u[o.collectionName].yIndex,u[o.collectionName].yIndex=u[e].yIndex,u[e].yIndex=d,d=u[o.collectionName].xIndex,u[o.collectionName].xIndex=0,u[e].xIndex=d),0}))}return u={boxes:u},Object.assign({},e,u);case"shiftLevel":return Object.assign({},e,{level:o});case"setPageUrl":return Object.assign({},e,{pageUrl:o});default:return e}}),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()));r.a.render(i.a.createElement(c.a,{store:T},i.a.createElement(S,null)),document.getElementById("root"))}},[[40,1,2]]]);
//# sourceMappingURL=main.f286ae25.chunk.js.map